# ğŸ”§ ç®¡ç†åå°æŠ€æœ¯è§„èŒƒæ–‡æ¡£

## ğŸ“‹ æŠ€æœ¯æ¶æ„è¯¦ç»†è®¾è®¡

### ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç®¡ç†å‘˜ç”¨æˆ·     â”‚    â”‚   æ™®é€šç”¨æˆ·       â”‚    â”‚   ç›‘æ§ç³»ç»Ÿ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç®¡ç†åå°å‰ç«¯    â”‚    â”‚  ç”¨æˆ·æŸ¥è¯¢å‰ç«¯    â”‚    â”‚  ç›‘æ§å‘Šè­¦ç³»ç»Ÿ    â”‚
â”‚   (Vue3 + TS)   â”‚    â”‚   (Vue3 + TS)   â”‚    â”‚ (Prometheus)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Nginx åå‘ä»£ç†  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  FastAPI åç«¯    â”‚
          â”‚  (ç®¡ç†API +     â”‚
          â”‚   æŸ¥è¯¢API)      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQLâ”‚  â”‚    Redis    â”‚  â”‚  GeoIP  â”‚
â”‚  æ•°æ®åº“   â”‚  â”‚    ç¼“å­˜     â”‚  â”‚  æ•°æ®åº“  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”Œ APIæ¥å£è®¾è®¡

#### ç®¡ç†åå°APIç«¯ç‚¹

```
# è®¤è¯ç®¡ç†
POST   /api/admin/auth/login          # ç®¡ç†å‘˜ç™»å½•
POST   /api/admin/auth/logout         # ç®¡ç†å‘˜ç™»å‡º
POST   /api/admin/auth/refresh        # åˆ·æ–°ä»¤ç‰Œ
GET    /api/admin/auth/profile        # è·å–ç®¡ç†å‘˜ä¿¡æ¯

# ç³»ç»Ÿç›‘æ§
GET    /api/admin/monitoring/system   # ç³»ç»ŸçŠ¶æ€ç›‘æ§
GET    /api/admin/monitoring/api      # APIæ€§èƒ½ç»Ÿè®¡
GET    /api/admin/monitoring/logs     # æ—¥å¿—æŸ¥è¯¢
POST   /api/admin/monitoring/alerts   # å‘Šè­¦é…ç½®

# æ•°æ®ç®¡ç†
GET    /api/admin/data/queries        # æŸ¥è¯¢è®°å½•ç®¡ç†
GET    /api/admin/data/statistics     # æ•°æ®ç»Ÿè®¡åˆ†æ
POST   /api/admin/data/export         # æ•°æ®å¯¼å‡º
DELETE /api/admin/data/cleanup        # æ•°æ®æ¸…ç†

# ç³»ç»Ÿé…ç½®
GET    /api/admin/config/system       # ç³»ç»Ÿé…ç½®
PUT    /api/admin/config/system       # æ›´æ–°é…ç½®
GET    /api/admin/config/cache        # ç¼“å­˜é…ç½®
POST   /api/admin/config/backup       # å¤‡ä»½ç®¡ç†
```

#### æ•°æ®æ¨¡å‹è®¾è®¡

```python
# ç®¡ç†å‘˜æ¨¡å‹
class AdminUser(BaseModel):
    id: int
    username: str
    email: Optional[str]
    role: str  # 'super_admin', 'admin', 'readonly'
    is_active: bool
    created_at: datetime
    last_login: Optional[datetime]

# æŸ¥è¯¢æ—¥å¿—æ¨¡å‹
class QueryLog(BaseModel):
    id: int
    ip_address: str
    query_ip: str
    result: Dict[str, Any]
    query_time: float
    created_at: datetime
    user_agent: Optional[str]
    source: str  # 'web', 'api', 'batch'

# ç³»ç»Ÿé…ç½®æ¨¡å‹
class SystemConfig(BaseModel):
    id: int
    config_key: str
    config_value: str
    description: Optional[str]
    updated_at: datetime
    updated_by: int

# ç›‘æ§æŒ‡æ ‡æ¨¡å‹
class MonitoringMetric(BaseModel):
    timestamp: datetime
    metric_name: str
    metric_value: float
    tags: Dict[str, str]
```

### ğŸ¨ å‰ç«¯ç»„ä»¶è®¾è®¡

#### ç»„ä»¶å±‚æ¬¡ç»“æ„

```
AdminApp
â”œâ”€â”€ Layout
â”‚   â”œâ”€â”€ Header (é¡¶éƒ¨å¯¼èˆª)
â”‚   â”œâ”€â”€ Sidebar (ä¾§è¾¹æ èœå•)
â”‚   â””â”€â”€ Main (ä¸»å†…å®¹åŒº)
â”œâ”€â”€ Dashboard (ä»ªè¡¨æ¿)
â”‚   â”œâ”€â”€ SystemOverview (ç³»ç»Ÿæ¦‚è§ˆ)
â”‚   â”œâ”€â”€ QuickStats (å¿«é€Ÿç»Ÿè®¡)
â”‚   â””â”€â”€ RecentActivity (æœ€è¿‘æ´»åŠ¨)
â”œâ”€â”€ Monitoring (ç›‘æ§æ¨¡å—)
â”‚   â”œâ”€â”€ SystemMonitor (ç³»ç»Ÿç›‘æ§)
â”‚   â”œâ”€â”€ APIMetrics (APIæŒ‡æ ‡)
â”‚   â”œâ”€â”€ LogViewer (æ—¥å¿—æŸ¥çœ‹)
â”‚   â””â”€â”€ AlertManager (å‘Šè­¦ç®¡ç†)
â”œâ”€â”€ DataManagement (æ•°æ®ç®¡ç†)
â”‚   â”œâ”€â”€ QueryHistory (æŸ¥è¯¢å†å²)
â”‚   â”œâ”€â”€ Statistics (ç»Ÿè®¡åˆ†æ)
â”‚   â”œâ”€â”€ Reports (æŠ¥è¡¨ç”Ÿæˆ)
â”‚   â””â”€â”€ DataExport (æ•°æ®å¯¼å‡º)
â””â”€â”€ SystemConfig (ç³»ç»Ÿé…ç½®)
    â”œâ”€â”€ GeneralSettings (é€šç”¨è®¾ç½®)
    â”œâ”€â”€ CacheConfig (ç¼“å­˜é…ç½®)
    â”œâ”€â”€ BackupManager (å¤‡ä»½ç®¡ç†)
    â””â”€â”€ UserManagement (ç”¨æˆ·ç®¡ç†)
```

#### çŠ¶æ€ç®¡ç†è®¾è®¡

```typescript
// Pinia Store è®¾è®¡
interface AdminState {
  // è®¤è¯çŠ¶æ€
  auth: {
    user: AdminUser | null
    token: string | null
    permissions: string[]
  }
  
  // ç³»ç»Ÿç›‘æ§çŠ¶æ€
  monitoring: {
    systemMetrics: SystemMetrics
    apiMetrics: APIMetrics
    alerts: Alert[]
    isRealTimeEnabled: boolean
  }
  
  // æ•°æ®ç®¡ç†çŠ¶æ€
  data: {
    queryLogs: QueryLog[]
    statistics: Statistics
    currentPage: number
    filters: DataFilters
  }
  
  // ç³»ç»Ÿé…ç½®çŠ¶æ€
  config: {
    systemConfig: SystemConfig
    cacheConfig: CacheConfig
    backupStatus: BackupStatus
  }
}
```

### ğŸ” å®‰å…¨è®¾è®¡

#### è®¤è¯æˆæƒæµç¨‹

```
1. ç®¡ç†å‘˜ç™»å½•
   â”œâ”€â”€ ç”¨æˆ·åå¯†ç éªŒè¯
   â”œâ”€â”€ ç”ŸæˆJWTè®¿é—®ä»¤ç‰Œ (15åˆ†é’Ÿ)
   â”œâ”€â”€ ç”Ÿæˆåˆ·æ–°ä»¤ç‰Œ (7å¤©)
   â””â”€â”€ è¿”å›ç”¨æˆ·ä¿¡æ¯å’Œæƒé™

2. APIè¯·æ±‚è®¤è¯
   â”œâ”€â”€ æ£€æŸ¥Authorizationå¤´éƒ¨
   â”œâ”€â”€ éªŒè¯JWTä»¤ç‰Œæœ‰æ•ˆæ€§
   â”œâ”€â”€ æ£€æŸ¥ç”¨æˆ·æƒé™
   â””â”€â”€ å…è®¸/æ‹’ç»è®¿é—®

3. ä»¤ç‰Œåˆ·æ–°
   â”œâ”€â”€ ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œ
   â”œâ”€â”€ éªŒè¯ä»¤ç‰Œæœ‰æ•ˆæ€§
   â”œâ”€â”€ ç”Ÿæˆæ–°çš„è®¿é—®ä»¤ç‰Œ
   â””â”€â”€ è¿”å›æ–°ä»¤ç‰Œ
```

#### æƒé™æ§åˆ¶çŸ©é˜µ

```
è§’è‰²æƒé™çŸ©é˜µ:
                    è¶…çº§ç®¡ç†å‘˜  ç³»ç»Ÿç®¡ç†å‘˜  åªè¯»ç”¨æˆ·
ç³»ç»Ÿç›‘æ§æŸ¥çœ‹           âœ“         âœ“         âœ“
ç³»ç»Ÿé…ç½®ä¿®æ”¹           âœ“         âœ“         âœ—
æ•°æ®å¯¼å‡º              âœ“         âœ“         âœ—
æ•°æ®åˆ é™¤              âœ“         âœ—         âœ—
ç”¨æˆ·ç®¡ç†              âœ“         âœ—         âœ—
ç³»ç»Ÿå¤‡ä»½æ¢å¤           âœ“         âœ—         âœ—
```

### ğŸ“Š ç›‘æ§æŒ‡æ ‡è®¾è®¡

#### ç³»ç»Ÿç›‘æ§æŒ‡æ ‡

```python
# ç³»ç»Ÿèµ„æºæŒ‡æ ‡
SYSTEM_METRICS = {
    'cpu_usage': 'CPUä½¿ç”¨ç‡ (%)',
    'memory_usage': 'å†…å­˜ä½¿ç”¨ç‡ (%)',
    'disk_usage': 'ç£ç›˜ä½¿ç”¨ç‡ (%)',
    'network_io': 'ç½‘ç»œIO (bytes/s)',
    'load_average': 'ç³»ç»Ÿè´Ÿè½½',
}

# APIæ€§èƒ½æŒ‡æ ‡
API_METRICS = {
    'request_count': 'è¯·æ±‚æ€»æ•°',
    'response_time_avg': 'å¹³å‡å“åº”æ—¶é—´ (ms)',
    'response_time_p95': '95%å“åº”æ—¶é—´ (ms)',
    'error_rate': 'é”™è¯¯ç‡ (%)',
    'concurrent_users': 'å¹¶å‘ç”¨æˆ·æ•°',
}

# ä¸šåŠ¡æŒ‡æ ‡
BUSINESS_METRICS = {
    'daily_queries': 'æ—¥æŸ¥è¯¢é‡',
    'unique_ips': 'ç‹¬ç«‹IPæ•°',
    'cache_hit_rate': 'ç¼“å­˜å‘½ä¸­ç‡ (%)',
    'top_countries': 'çƒ­é—¨å›½å®¶/åœ°åŒº',
    'query_sources': 'æŸ¥è¯¢æ¥æºåˆ†å¸ƒ',
}
```

#### å‘Šè­¦è§„åˆ™é…ç½®

```yaml
# å‘Šè­¦è§„åˆ™ç¤ºä¾‹
alert_rules:
  - name: "é«˜CPUä½¿ç”¨ç‡"
    condition: "cpu_usage > 80"
    duration: "5m"
    severity: "warning"
    notification: ["email", "webhook"]
    
  - name: "APIå“åº”æ—¶é—´è¿‡é•¿"
    condition: "response_time_avg > 2000"
    duration: "2m"
    severity: "critical"
    notification: ["email", "sms"]
    
  - name: "é”™è¯¯ç‡è¿‡é«˜"
    condition: "error_rate > 5"
    duration: "1m"
    severity: "critical"
    notification: ["email", "webhook"]
```

### ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

#### è¡¨ç»“æ„è®¾è®¡

```sql
-- ç®¡ç†å‘˜ç”¨æˆ·è¡¨
CREATE TABLE admin_users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    email VARCHAR(100),
    role VARCHAR(20) DEFAULT 'admin',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP,
    login_attempts INTEGER DEFAULT 0,
    locked_until TIMESTAMP
);

-- æŸ¥è¯¢æ—¥å¿—è¡¨ (åˆ†åŒºè¡¨)
CREATE TABLE query_logs (
    id BIGSERIAL PRIMARY KEY,
    ip_address INET NOT NULL,
    query_ip INET NOT NULL,
    result JSONB,
    query_time FLOAT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    user_agent TEXT,
    source VARCHAR(20) DEFAULT 'web',
    response_size INTEGER,
    cache_hit BOOLEAN DEFAULT false
) PARTITION BY RANGE (created_at);

-- ç³»ç»Ÿé…ç½®è¡¨
CREATE TABLE system_config (
    id SERIAL PRIMARY KEY,
    config_key VARCHAR(100) UNIQUE NOT NULL,
    config_value TEXT,
    config_type VARCHAR(20) DEFAULT 'string',
    description TEXT,
    is_sensitive BOOLEAN DEFAULT false,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by INTEGER REFERENCES admin_users(id)
);

-- ç›‘æ§æŒ‡æ ‡è¡¨ (æ—¶åºæ•°æ®)
CREATE TABLE monitoring_metrics (
    id BIGSERIAL PRIMARY KEY,
    timestamp TIMESTAMP NOT NULL,
    metric_name VARCHAR(100) NOT NULL,
    metric_value FLOAT NOT NULL,
    tags JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å‘Šè­¦è®°å½•è¡¨
CREATE TABLE alert_logs (
    id BIGSERIAL PRIMARY KEY,
    alert_name VARCHAR(100) NOT NULL,
    severity VARCHAR(20) NOT NULL,
    message TEXT,
    triggered_at TIMESTAMP NOT NULL,
    resolved_at TIMESTAMP,
    status VARCHAR(20) DEFAULT 'active',
    notification_sent BOOLEAN DEFAULT false
);
```

#### ç´¢å¼•ä¼˜åŒ–

```sql
-- æŸ¥è¯¢æ—¥å¿—è¡¨ç´¢å¼•
CREATE INDEX idx_query_logs_created_at ON query_logs (created_at);
CREATE INDEX idx_query_logs_query_ip ON query_logs (query_ip);
CREATE INDEX idx_query_logs_source ON query_logs (source);

-- ç›‘æ§æŒ‡æ ‡è¡¨ç´¢å¼•
CREATE INDEX idx_monitoring_metrics_timestamp ON monitoring_metrics (timestamp);
CREATE INDEX idx_monitoring_metrics_name_time ON monitoring_metrics (metric_name, timestamp);

-- å‘Šè­¦è®°å½•è¡¨ç´¢å¼•
CREATE INDEX idx_alert_logs_triggered_at ON alert_logs (triggered_at);
CREATE INDEX idx_alert_logs_status ON alert_logs (status);
```

### ğŸš€ éƒ¨ç½²é…ç½®

#### Docker Compose é…ç½®

```yaml
version: '3.8'
services:
  # ç®¡ç†åå°å‰ç«¯
  admin-frontend:
    build: ./frontend-admin
    ports:
      - "8081:80"
    depends_on:
      - admin-backend
    environment:
      - VUE_APP_API_URL=http://localhost:8000
      
  # æ‰©å±•çš„åç«¯æœåŠ¡
  admin-backend:
    build: ./backend-fastapi
    ports:
      - "8000:8000"
    depends_on:
      - postgres
      - redis
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/ipquery
      - REDIS_URL=redis://redis:6379/0
      - ADMIN_SECRET_KEY=your-secret-key
      
  # ç›‘æ§æœåŠ¡
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      
  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
```

### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### æ•°æ®åº“ä¼˜åŒ–
- **åˆ†åŒºè¡¨**: æŒ‰æ—¶é—´åˆ†åŒºæŸ¥è¯¢æ—¥å¿—è¡¨
- **ç´¢å¼•ä¼˜åŒ–**: é’ˆå¯¹æŸ¥è¯¢æ¨¡å¼ä¼˜åŒ–ç´¢å¼•
- **è¿æ¥æ± **: é…ç½®åˆé€‚çš„æ•°æ®åº“è¿æ¥æ± 
- **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨EXPLAINåˆ†ææ…¢æŸ¥è¯¢

#### ç¼“å­˜ç­–ç•¥
- **Redisç¼“å­˜**: ç¼“å­˜é¢‘ç¹æŸ¥è¯¢çš„ç»Ÿè®¡æ•°æ®
- **åº”ç”¨ç¼“å­˜**: ç¼“å­˜ç³»ç»Ÿé…ç½®å’Œæƒé™ä¿¡æ¯
- **CDNç¼“å­˜**: é™æ€èµ„æºCDNåŠ é€Ÿ

#### å‰ç«¯ä¼˜åŒ–
- **ä»£ç åˆ†å‰²**: æŒ‰è·¯ç”±åˆ†å‰²ä»£ç åŒ…
- **æ‡’åŠ è½½**: ç»„ä»¶å’Œå›¾è¡¨æ‡’åŠ è½½
- **è™šæ‹Ÿæ»šåŠ¨**: å¤§æ•°æ®åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨
- **ç¼“å­˜ç­–ç•¥**: åˆç†çš„HTTPç¼“å­˜ç­–ç•¥

---

**ğŸ”§ æŠ€æœ¯è§„èŒƒæ–‡æ¡£** - ç¡®ä¿ç®¡ç†åå°å¼€å‘çš„æŠ€æœ¯æ ‡å‡†å’Œè´¨é‡ âš¡
